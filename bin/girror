#!/usr/bin/env node
var program = require('commander');
var logule = require('logule');
var girror = require('..');

program
  .usage('[options] remote-url[#branch] work-tree')
  .option('-v, --verbose', 'verbose output')
  .option('-r, --remote <url>', '[deprecated] git remote url')
  .option('-w, --worktree <path>', '[deprecated] path to worktree')
  .option('-b, --branch <branch>', '[deprecated] branch to mirror')
  .parse(process.argv);

var remote = program.args[0] || program.remote;
var worktree = program.args[1] || program.worktree;
if (program.branch) remote = remote + '#' + program.branch;

if (!remote) {
  throw new Error('remote url is required');
}

if (!worktree) {
  throw new Error('worktree is required');
}

if (!program.verbose) {
  logule.suppress('trace');
}

return girror(remote, worktree, { logger: logule }, function(err) {
  if (err) logule.error(err);
  else logule.info('done');
});
